name: readlead-monitoring-dev

services:
  promtail:
    image: grafana/promtail:latest
    container_name: promtail
    expose: ["9080"]
    volumes:
      - /var/lib/docker/containers:/var/lib/docker/containers:ro
      - /var/run/docker.sock:/var/run/docker.sock
      - ./promtail-config.yaml:/etc/promtail/config.yml
    command: [ "-config.file=/etc/promtail/config.yml" ]
    privileged: true
    
  loki:
    image: grafana/loki:3.4.1
    expose: ["3100"]
    command: -config.file=/etc/loki/local-config.yaml

  prometheus:
    image: prom/prometheus:latest
    container_name: prometheus
    expose: ["9090"]
    volumes:
      - ./prometheus.yml:/etc/prometheus/prometheus.yml
      - prometheusdata:/prometheus
    networks:
      - readlead-network
      - default

  grafana:
    image: grafana/grafana:latest
    container_name: grafana
    ports:
      - "3000:3000"
    env_file:
      - ".env"
    environment:
        GF_SECURITY_ADMIN_USER: ${GF_SECURITY_ADMIN_USER}
        GF_SECURITY_ADMIN_PASSWORD: ${GF_SECURITY_ADMIN_PASSWORD}
    volumes:
      - ./grafana/datasources.yaml:/etc/grafana/provisioning/datasources/datasources.yaml
      - grafanadata:/var/lib/grafana

volumes:
  grafanadata:
  prometheusdata:

networks:
  default:
    name: readlead-monitoring-internal
  readlead-network:
    external: true